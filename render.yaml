# Blueprint for the I-Ching AI application
# This file defines the infrastructure for deploying the app on Render.

services:
  # ------------------ Backend Service (API Proxy) ------------------
  # This service securely handles requests to the Gemini API.
  - type: web
    name: iching-ai-backend
    runtime: node
    plan: free # Can be scaled up if needed
    buildCommand: 'npm install'
    startCommand: 'node server.js'
    envVars:
      - key: API_KEY
        sync: false # The API key is set securely in the Render dashboard, not in code.

  # ------------------ Frontend Service (Static Site) ------------------
  # This service serves the compiled React application.
  - type: web # Use 'web' for service type.
    name: iching-ai-frontend
    runtime: static # Specify 'static' runtime to serve static files.
    plan: free
    buildCommand: 'npm install && npm run build'
    staticPublishPath: dist # Correct property for the output directory.
    routes:
      # Rewrite rule to proxy API requests from the frontend to the backend.
      # This makes `/api/...` calls from the frontend work in production.
      - type: rewrite
        source: /api/:path*
        destination: https://iching-ai-backend.onrender.com/api/:path*
      # Rewrite rule for single-page applications (SPA).
      # This ensures all paths are handled by index.html for client-side routing.
      - type: rewrite
        source: /*
        destination: /index.html
